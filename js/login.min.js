(()=>{"use strict";addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.querySelector(".js-login"),t="is-active",n="submit-status";if(!e)return;e.addEventListener("submit",(function(e){if(!e.target.classList.contains("has-errors")){let s=e.target,o=s.dataset.url,l=s.querySelectorAll(".login__tab"),i=s.querySelector(".js-otp"),c=new FormData(s),u=(o.includes("?")?"&":"?")+new URLSearchParams(c).toString();o+=u,(async()=>{try{let e=await fetch(o);if(!e.ok)return;let s=await e.json();!0===s.status?s.url?window.location.assign(s.url):(l.forEach((e=>{e.classList.toggle(t),e.removeAttribute("disabled")})),r.forEach((e=>{e.value=""})),i.focus(),function(){const e=document.querySelector(".otp__timer span"),n=e.closest("form").querySelectorAll(".login__tab");let r=e.parentElement.dataset.timer;e.textContent=r--;const a=setInterval((()=>{e.textContent=r,0===r?(clearInterval(a),n.forEach((e=>{e.classList.contains(t)&&e.setAttribute("disabled",""),e.classList.toggle(t)}))):r--}),1e3)}()):function(e=!1){if(r.forEach((e=>{e.classList.add(a)})),e.message){const t=document.createElement("div"),r=document.querySelector(".login__tab.is-active");t.classList.add(n,"submit-status_error"),t.innerHTML=e.message;let a=document.querySelector(`.${n}`);a&&a.remove(),r.append(t)}}(s)}catch(e){return void console.error(e)}})()}}));const r=document.querySelectorAll(".js-otp"),a="is-error";function s(e){let t=e.clipboardData.getData("text");t=t.replace(/\D/g,""),t=t.substring(0,r.length);let n=t.split("");r.forEach(((t,r)=>{if(!(Number.parseInt(n[r])>=0))return e.stopPropagation(),e.preventDefault(),!1;t.value=n[r],t.blur()})),l()}function o(e){let t=e.target,n=t.dataset.index;if(!e.ctrlKey&&"v"!==e.key)if("Backspace"==e.key||"Delete"==e.key)e.stopPropagation(),e.preventDefault(),t.value="",n>0&&setTimeout((()=>t.previousElementSibling.focus()),0);else{let a=e.key.replace(/\D/g,"");if(""==a)return e.stopPropagation(),e.preventDefault(),!1;0==t.value.length&&(t.value=a),n<r.length-1&&setTimeout((()=>t.nextElementSibling.focus()),0)}n==r.length-1&&(t.classList.add("is-blur-otp"),t.blur(),l())}function l(){let t=Array.from(r).map((e=>e.value)).join(""),n=document.querySelector('.otp input[name="f"]');t.length==r.length&&(n.value=t,e.dispatchEvent(new Event("submit")))}r&&r.forEach(((e,t)=>{e.dataset.index=t,e.addEventListener("paste",s),e.addEventListener("keyup",o),e.addEventListener("focus",(()=>{e.classList.remove("is-blur-otp"),function(){r.forEach((e=>{e.classList.remove(a)}));let e=document.querySelector(`.${n}`);e&&e.remove()}()}))}))}()}))})();