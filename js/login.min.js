(()=>{"use strict";addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.querySelector(".js-login"),t="is-active",r="submit-status";if(!e)return;e.addEventListener("submit",(function(e){if(!e.target.classList.contains("has-errors")){let a=e.target,o=a.dataset.url,l=a.querySelectorAll(".login__tab"),i=a.querySelector(".js-otp"),c=new FormData(a),u=(o.includes("?")?"&":"?")+new URLSearchParams(c).toString();o+=u,(async()=>{try{let e=await fetch(o);if(!e.ok)return;let a=await e.json();!0===a.status?a.url?window.location.assign(a.url):(l.forEach((e=>{e.classList.toggle(t),e.removeAttribute("disabled")})),n.forEach((e=>{e.value=""})),i.focus(),function(){const e=document.querySelector(".otp__timer span"),r=e.closest("form").querySelectorAll(".login__tab");let n=e.parentElement.dataset.timer;e.textContent=n--;const s=setInterval((()=>{e.textContent=n,0===n?(clearInterval(s),r.forEach((e=>{e.classList.contains(t)&&e.setAttribute("disabled",""),e.classList.toggle(t)}))):n--}),1e3)}()):function(e=!1){if(n.forEach((e=>{e.classList.add(s)})),e.message){const t=document.createElement("div"),n=document.querySelector(".otp__footer");t.classList.add(r,"submit-status_error"),t.innerHTML=e.message;let s=document.querySelector(`.${r}`);s&&s.remove(),n.prepend(t)}}(a)}catch(e){return void console.error(e)}})()}}));const n=document.querySelectorAll(".js-otp"),s="is-error";function a(e){let t=e.clipboardData.getData("text");t=t.replace(/\D/g,""),t=t.substring(0,n.length);let r=t.split("");n.forEach(((t,n)=>{if(!(Number.parseInt(r[n])>=0))return e.stopPropagation(),e.preventDefault(),!1;t.value=r[n],t.blur()})),l()}function o(e){let t=e.target,r=t.dataset.index;if(!e.ctrlKey&&"v"!==e.key)if("Backspace"==e.key||"Delete"==e.key)e.stopPropagation(),e.preventDefault(),t.value="",r>0&&setTimeout((()=>t.previousElementSibling.focus()),0);else{let s=e.key.replace(/\D/g,"");if(""==s)return e.stopPropagation(),e.preventDefault(),!1;0==t.value.length&&(t.value=s),r<n.length-1&&setTimeout((()=>t.nextElementSibling.focus()),0)}r==n.length-1&&(t.classList.add("is-blur-otp"),t.blur(),l())}function l(){let t=Array.from(n).map((e=>e.value)).join(""),r=document.querySelector('.otp input[name="f"]');t.length==n.length&&(r.value=t,e.dispatchEvent(new Event("submit")))}n&&n.forEach(((e,t)=>{e.dataset.index=t,e.addEventListener("paste",a),e.addEventListener("keyup",o),e.addEventListener("focus",(()=>{e.classList.remove("is-blur-otp"),function(){n.forEach((e=>{e.classList.remove(s)}));let e=document.querySelector(`.${r}`);e&&e.remove()}()}))}))}()}))})();