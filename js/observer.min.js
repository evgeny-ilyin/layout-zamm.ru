(()=>{"use strict";window.productBlockCollapseHandler||(window.productBlockCollapseHandler=(e=!1)=>{if(!e)return void document.querySelectorAll(".block-collapsible").forEach((e=>productBlockCollapseHandler(e)));if(e.querySelector(".block-collapse"))return;let t=e.scrollHeight,s=e.getBoundingClientRect().height,o="is-opened";if(t>s){let s=document.createElement("div"),a=document.createElement("button");a.innerHTML="<span>Показать всё</span><span>Свернуть</span>",a.classList.add("block-collapse__btn","js-block-collpase","is-closed"),s.classList.add("block-collapse"),s.appendChild(a),e.appendChild(s);let r=e.querySelector(".block-collapse"),l=r.getBoundingClientRect().height,n=r.querySelector(".js-block-collpase");if(!n)return;n.addEventListener("click",(()=>{n.classList.toggle("is-closed"),e.style.maxHeight?(e.style.maxHeight=null,e.classList.remove(o)):(e.style.maxHeight=t+l+"px",e.classList.add(o))}))}}),window.productProps||(window.productProps=()=>{document.addEventListener("change",(e=>{if(!e.target.closest(".prop"))return;const t=e.target,s=t.closest(".item"),o=t.closest(".item__details"),a=t.closest(".product"),r=t.closest("form");if(!r)return;let l=new FormData(r),n={},c={},i=t.dataset.url;n={name:t.name,checked:!0},t.dataset.params&&(c={params:JSON.parse(t.dataset.params)}),Object.assign(n,c),l.append("element",JSON.stringify(n)),s&&(async()=>{try{fetchLoader([s,o],"start");let e=await fetch(i,{method:"POST",body:l});if(!e.ok)return;let t=await e.json();!0===t.status&&(updateChunks(t.chunks,s),catalogItemGalleriesInit(s),productPropsCollapseHandler(s)),fetchLoader([s,o],"stop")}catch(e){return void console.error(e)}})(),a&&(async()=>{try{fetchLoader([a],"start");let e=await fetch(i,{method:"POST",body:l});if(!e.ok)return;let t=await e.json();!0===t.status&&(updateChunks(t.chunks),tabsInit(),carouselsInit()),t.url&&setWindowLocation(t.url),fetchLoader([a],"stop")}catch(e){return void console.error(e)}})()}))}),window.productPropsHoverHandler||(window.productPropsHoverHandler=()=>{const e=document.querySelectorAll(".catalog-items, .product-carousel");e.length&&e.forEach((e=>{e.addEventListener("mouseover",(e=>{const t=e.target.closest(".item");t&&!document.body.classList.contains("is-touch")&&t.addEventListener("mouseenter",(()=>{const e=t.dataset.url,s=t.querySelector(".item__details"),o=t.querySelector(".skeleton");e&&(!s||s.innerHTML.trim().length&&!o||t.classList.contains("loading")||(t.classList.add("loading"),showSkeleton(s,"tpl-props"),(async()=>{try{let o=await fetch(e);if(!o.ok)return;let a=await o.text();s.innerHTML="",s.innerHTML=a,t.classList.remove("loading"),productPropsCollapseHandler(t)}catch(e){return void console.error(e)}})()))}))}))}))}),window.productPropsCollapseHandler||(window.productPropsCollapseHandler=e=>{if(!e)return;const t=e.querySelectorAll(".js-prop-collapse"),s="is-opened";t.forEach((e=>{let t=e.parentElement,o=t.querySelector('input[type="hidden"]');t.classList.contains(s)||isStrOverflowX(t)?e.addEventListener("click",(()=>{t.classList.toggle(s),o.value=1==o.value?0:1})):e.classList.add("hidden")}))}),window.tabsInit||(window.tabsInit=()=>{const e="is-active",t=document.querySelectorAll(".tabs");t&&t.forEach((t=>{if(t.querySelector(`.${e}`))return;let s=t.querySelectorAll(".tabs__header, .tabs__content");s&&s.forEach((t=>{t.querySelector(".tab-nav, .tab-block").classList.add(e)}))}))}),window.tabsHandler||(window.tabsHandler=(e=!1)=>{const t="is-active";e&&blockObserver(e),document.addEventListener("click",(e=>{const s=e.target.closest(".js-tab-nav");if(!s||s.classList.contains(t))return;const o=s.closest(".tabs").querySelectorAll(`.${t}`),a=s.dataset.tab,r=s.closest(".tabs").querySelector(`[data-tab-content=${a}]`);o.forEach((e=>e.classList.remove(t))),s.classList.add(t),r.classList.add(t)}))}),window.blockObserver||(window.blockObserver=(e=!1)=>{const t=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){let o=e.target,a=o.dataset.url,r={},l={};if(!a)return;o.dataset.params&&(l=JSON.parse(o.dataset.params)),Object.assign(r,l),(async()=>{try{fetchLoader(o,"start",{class:"_sm"});let e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(r)});if(!e.ok)return;let t=await e.json();!0===t.status&&(o.innerHTML=t.content),t.svg&&addToSvgSprite(t.svg),s(o),fetchLoader(o,"stop")}catch(e){return void console.error(e)}})(),t.unobserve(e.target)}}))}),{});(e?e.querySelectorAll("[data-observer='true']"):document.querySelectorAll("[data-observer='true']")).forEach((e=>t.observe(e)));let s=e=>{try{productBlockCollapseHandler(),carouselsInit(e),catalogItemGalleriesInit(),catalogItemGalleryHandler(),tabsInit(),tabsHandler(e),productPropsHoverHandler(),overflowTags(),setFavourites(),selectsInit(),globalForm.validation()}catch(e){console.error(e)}}}),addEventListener("DOMContentLoaded",(()=>{blockObserver()}))})();