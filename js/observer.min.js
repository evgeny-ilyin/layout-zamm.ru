(()=>{"use strict";window.productBlockCollapseHandler||(window.productBlockCollapseHandler=(e=!1)=>{if(!e)return void document.querySelectorAll(".block-collapsible").forEach((e=>productBlockCollapseHandler(e)));if(e.querySelector(".block-collapse"))return;let t=e.scrollHeight,s=e.getBoundingClientRect().height,a="is-opened",o=e.dataset.label??"Показать всё";if(t>s){let s=document.createElement("div"),r=document.createElement("button");r.innerHTML=`<span>${o}</span><span>Свернуть</span>`,r.classList.add("block-collapse__btn","js-block-collpase","is-closed"),s.classList.add("block-collapse"),s.appendChild(r),e.appendChild(s);let l=e.querySelector(".block-collapse"),n=l.getBoundingClientRect().height,c=l.querySelector(".js-block-collpase");if(!c)return;c.addEventListener("click",(()=>{c.classList.toggle("is-closed"),e.style.maxHeight?(e.style.maxHeight=null,e.classList.remove(a)):(e.style.maxHeight=t+n+"px",e.classList.add(a))}))}}),window.productProps||(window.productProps=()=>{document.addEventListener("change",(e=>{if(!e.target.closest(".prop"))return;const t=e.target,s=t.closest(".item"),a=t.closest(".item__details"),o=t.closest(".product"),r=t.closest("form");if(!r)return;let l=new FormData(r),n={},c={},d=t.dataset.url;n={name:t.name,checked:!0},t.dataset.params&&(c={params:JSON.parse(t.dataset.params)}),Object.assign(n,c),l.append("element",JSON.stringify(n)),s&&(async()=>{try{fetchLoader([s,a],"start");let e=await fetch(d,{method:"POST",body:l});if(!e.ok)return;let t=await e.json();!0===t.status&&(updateChunks(t.chunks,s),catalogItemGalleriesInit(s),productPropsCollapseHandler(s)),fetchLoader([s,a],"stop")}catch(e){return void console.error(e)}})(),o&&(async()=>{try{fetchLoader([o],"start");let e=await fetch(d,{method:"POST",body:l});if(!e.ok)return;let t=await e.json();!0===t.status&&(updateChunks(t.chunks),tabsInit(),carouselsInit()),t.url&&setWindowLocation(t.url),fetchLoader([o],"stop")}catch(e){return void console.error(e)}})()}))}),window.productPropsHoverHandler||(window.productPropsHoverHandler=()=>{const e=document.querySelectorAll(".catalog-items, .product-carousel");e.length&&e.forEach((e=>{e.addEventListener("mouseover",(e=>{const t=e.target.closest(".item");t&&!document.body.classList.contains("is-touch")&&t.addEventListener("mouseenter",(()=>{const e=t.dataset.url,s=t.querySelector(".item__details"),a=t.querySelector(".skeleton");e&&(!s||s.innerHTML.trim().length&&!a||t.classList.contains("loading")||(t.classList.add("loading"),showSkeleton(s,"tpl-props"),(async()=>{try{let a=await fetch(e);if(!a.ok)return;let o=await a.text();s.innerHTML="",s.innerHTML=o,t.classList.remove("loading"),productPropsCollapseHandler(t)}catch(e){return void console.error(e)}})()))}))}))}))}),window.productPropsCollapseHandler||(window.productPropsCollapseHandler=e=>{if(!e)return;const t=e.querySelectorAll(".js-prop-collapse"),s="is-opened";t.forEach((e=>{let t=e.parentElement,a=t.querySelector('input[type="hidden"]');t.classList.contains(s)||isStrOverflowX(t)?e.addEventListener("click",(()=>{t.classList.toggle(s),a.value=1==a.value?0:1})):e.classList.add("hidden")}))}),window.tabsInit||(window.tabsInit=()=>{const e="is-active",t=document.querySelectorAll(".tabs");t&&t.forEach((t=>{if(t.querySelector(`.${e}`))return;let s=t.querySelectorAll(".tabs__header, .tabs__content");s&&s.forEach((t=>{t.querySelector(".tab-nav, .tab-block").classList.add(e)}))}))}),window.tabsHandler||(window.tabsHandler=(e=!1)=>{const t="is-active";e&&blockObserver(e),document.addEventListener("click",(e=>{const s=e.target.closest(".js-tab-nav");if(!s||s.classList.contains(t))return;const a=s.closest(".tabs").querySelectorAll(`.${t}`),o=s.dataset.tab,r=s.closest(".tabs").querySelector(`[data-tab-content=${o}]`);a.forEach((e=>e.classList.remove(t))),s.classList.add(t),r.classList.add(t)}))}),window.blockObserver||(window.blockObserver=(e=!1)=>{const t=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){let a=e.target,o=a.dataset.url,r={},l={};if(!o)return;a.dataset.params&&(l=JSON.parse(a.dataset.params)),Object.assign(r,l),(async()=>{try{fetchLoader(a,"start",{class:"_sm"});let e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(r)});if(!e.ok)return;let t=await e.json();!0===t.status&&(a.innerHTML=t.content),t.svg&&addToSvgSprite(t.svg),s(a),fetchLoader(a,"stop")}catch(e){return void console.error(e)}})(),t.unobserve(e.target)}}))}),{});(e?e.querySelectorAll("[data-observer='true']"):document.querySelectorAll("[data-observer='true']")).forEach((e=>t.observe(e)));let s=e=>{try{productBlockCollapseHandler(),carouselsInit(e),catalogItemGalleriesInit(),catalogItemGalleryHandler(),tabsInit(),tabsHandler(e),productPropsHoverHandler(),overflowTags(),setFavourites(),selectsInit(),globalForm.validation()}catch(e){console.error(e)}}}),addEventListener("DOMContentLoaded",(()=>{blockObserver()}))})();