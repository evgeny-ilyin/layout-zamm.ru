(()=>{"use strict";function t(t){const e=t.querySelector(".js-promocode-submit");if(!e)return;let r=e.dataset.url,o=e.previousElementSibling,a=o.value,s=new FormData;a.length&&r&&(s.append("promocode",a.toUpperCase()),(async()=>{try{btnLoader(e),o.setAttribute("disabled",!0);let t=await fetch(r,{method:"POST",body:s});if(!t.ok)return;let a=await t.json();!0===a.status&&(o.value="",updateChunks(a.chunks)),btnLoader(e,"stop"),o.removeAttribute("disabled")}catch(t){return void console.error(t)}})())}addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.querySelector(".js-order");e&&(document.addEventListener("change",(t=>{"true"==t.target.dataset.watch&&function(t,e){let r=t.dataset.url,o="get"==e.dataset.method?"get":"post",a=e.dataset.params,s=t.querySelector("form"),n=new FormData(s);if(a){let t=JSON.parse(a);Object.keys(t).forEach((e=>{n.set(e,t[e])}))}if("get"==o){let e=(r.includes("?")?"&":"?")+new URLSearchParams(n).toString();r+=e,(async()=>{try{fetchLoader([t],"start");let e=await fetch(r);if(!e.ok)return;let o=await e.json();!0===o.status&&(updateChunks(o.chunks),selectsInit()),fetchLoader([t],"stop")}catch(t){return void console.error(t)}})()}else(async()=>{try{fetchLoader([t],"start");let e=await fetch(r,{method:"POST",body:n});if(!e.ok)return;let o=await e.json();!0===o.status&&(updateChunks(o.chunks),selectsInit()),fetchLoader([t],"stop")}catch(t){return void console.error(t)}})()}(e,t.target)})),document.addEventListener("keydown",(e=>{e.target.closest(".js-promocode-input")&&"Enter"==e.key&&t(e.target.parentElement)})),document.addEventListener("click",(e=>{e.target.closest(".js-promocode-submit")&&t(e.target.closest(".js-promocode-submit").parentElement)})),document.addEventListener("click",(t=>{const e=t.target.closest(".js-promocode-remove");e&&function(t){let e=t.dataset.url;e&&(async()=>{try{let t=await fetch(e);if(!t.ok)return;let r=await t.json();!0===r.status&&updateChunks(r.chunks)}catch(t){return void console.error(t)}})()}(e)})))}()}))})();