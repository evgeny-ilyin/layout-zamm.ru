(()=>{"use strict";function t(t,e){const a=t.closest("form")||t.closest(".item__props").querySelector("form");let o=new FormData(a),r=t.dataset.id,s=t.dataset.url;o.append("trigger",e),o.append("id",r),(async()=>{try{btnLoader(t);let e=await fetch(s,{method:"POST",body:o});if(!e.ok)return;let a=await e.json();if(!0===a.status){t.classList.add("in-cart");let e=document.querySelector('[data-id="cart-amount"]');if(!e)return;e.dataset.amount=isNaN(a.amount)?0:a.amount}btnLoader(t,"stop")}catch(t){return void console.error(t)}})()}addEventListener("DOMContentLoaded",(()=>{document.addEventListener("click",(e=>{if(e.target.closest(".js-add-to-cart")){let a=e.target.closest(".js-add-to-cart"),o="",r="in-cart";if(!a)return;if(a.classList.contains(r)&&a.dataset.cart)return void window.location.assign(a.dataset.cart);a.closest(".item")&&(o="addItemCatalog"),a.closest(".product")&&(o="addItem"),a.closest(".constructor")&&(o="addItemConstructor"),t(a,o)}})),document.addEventListener("change",(e=>{if("amount"==e.target.name){let a=e.target.closest(".product__purchase").querySelector(".js-add-to-cart"),o="";if(!a)return;a.closest(".product")&&(o="changeAmount"),t(a,o)}})),document.addEventListener("click",(t=>{if(t.target.closest(".js-fav")){const e=t.target.closest(".js-fav");if(!e)return;let a=new FormData,o=Number(e.dataset.id),r=e.dataset.url;a.append("id",o),(async()=>{try{let t=await fetch(r,{method:"POST",body:a});if(!t.ok)return;let e=await t.json();if(!0===e.status){setFavourites(o);let t=document.querySelector('[data-id="fav-amount"]');if(!t)return;t.dataset.amount=isNaN(e.amount)?0:e.amount}}catch(t){return void console.error(t)}})()}}))}))})();