"use strict";(self.webpackChunkwp=self.webpackChunkwp||[]).push([[43],{43:function(t,e,i){i.r(e),i.d(e,{default:function(){return E}});var s=i(135),r=i(141);var a=new class{constructor(){this.eventEmitter=new r.Z,this.eventEmitter.register=this.eventEmitter.register.bind(this.eventEmitter),this.eventEmitter.unregister=this.eventEmitter.unregister.bind(this.eventEmitter),this.handleEvent=this.handleEvent.bind(this),this.getData=this.getData.bind(this),this._store={}}init(){s.Z.register(this.handleEvent)}handleEvent(t){if("constructor:add"===t.type&&t.id&&!this._store[t.id]&&(this._store[t.id]={id:t.id,amount:1,color:t.color,colorPic:t.colorPic,texture:t.texture,texturePic:t.texturePic},this.eventEmitter.emit()),"constructor:amount"===t.type&&t.id&&void 0!==t.value){var e=this._store[t.id];e&&(e.amount=Number(t.value),this.eventEmitter.emit())}if("constructor:color"===t.type&&t.id){var i=this._store[t.id];i&&(i.color=t.color,i.colorPic=t.colorPic,this.eventEmitter.emit())}if("constructor:texture"===t.type&&t.id){var s=this._store[t.id];s&&(s.texture=t.texture,s.texturePic=t.texturePic,this.eventEmitter.emit())}}getData(){return this._store}};a.init();var n={register:a.eventEmitter.register,unregister:a.eventEmitter.unregister,getData:a.getData},o=i(743),h={price:null};class d extends HTMLElement{constructor(){super(),this._id=void 0,this._options=h,this.handleStore=this.handleStore.bind(this)}connectedCallback(){this._id=this.dataset.id,this._options=Object.assign({},h,this.dataset),this._id&&(this.handleStore(),n.register(this.handleStore))}disconnectedCallback(){n.unregister(this.handleStore)}handleStore(){if(this._id){var t=n.getData()[this._id];if(t&&this._options.price){var e=Number(this._options.price)*t.amount;this.innerHTML=(0,o.c1)(e)}}}}customElements.define("constructor-total",d);var c=i(366),l=i(698),u={method:"GET",action:void 0,modelUrl:void 0},m=".js-reload-model",p=".js-change-texture",_=".js-change-color",v=t=>{var e=t.closest("label"),i=null==e?void 0:e.querySelector("img");return null==i?void 0:i.src};class g extends HTMLElement{constructor(){super(),this._id=void 0,this._options=u,this._form=null,this.fetchData=this.fetchData.bind(this),this.collectData=this.collectData.bind(this),this.getInputParams=this.getInputParams.bind(this),this.handleStore=this.handleStore.bind(this),this.handleChange=this.handleChange.bind(this),this.handleDispatcher=this.handleDispatcher.bind(this)}connectedCallback(){this._id=this.dataset.id,this._options=Object.assign({},u,this.dataset),this._id&&(this.handleStore(),n.register(this.handleStore),this.addEventListener("change",this.handleChange),s.Z.register(this.handleDispatcher))}disconnectedCallback(){n.unregister(this.handleStore),this.removeEventListener("change",this.handleChange),s.Z.unregister(this.handleDispatcher)}collectData(){if(this._form=this.querySelector("form"),this._form){var t=new FormData(this._form);return(0,l.UL)(t)}return{}}handleChange(t){var e=t.target,i=e.closest("input".concat(m)),r=e.closest("input".concat(_)),a=e.closest("input".concat(p));if(r){var n=r.dataset.color,o=v(r);s.Z.emit({type:"constructor:color",id:this._id,color:n,colorPic:o}),this.fetchData(r,this._options.action)}if(a){var h=a.dataset.texture,d=v(a);s.Z.emit({type:"constructor:texture",id:this._id,texture:h,texturePic:d}),this.fetchData(a,this._options.action)}i&&this.fetchData(i,this._options.modelUrl)}fetchData(t,e){var i=this.getInputParams(t);e&&(s.Z.emit({type:"outlet:request"}),setTimeout((()=>{var t;e&&(0,c.Be)({url:e,method:null===(t=this._options.method)||void 0===t?void 0:t.toUpperCase(),body:i}).then((()=>{s.Z.emit({type:"outlet:request-cancel"})}))}),10))}getInputParams(t){if(t){var e=t.dataset.params?JSON.parse(t.dataset.params):{};return Object.assign({action:"changeConstructorProps",element:{name:t.name,value:t.value,checked:t.checked,params:e}},this.collectData())}}handleStore(){this._id}handleDispatcher(t){t.type}}customElements.define("constructor-tools",g);var b={type:void 0};class f extends HTMLImageElement{constructor(){super(),this._id=void 0,this._options=b,this.handleStore=this.handleStore.bind(this)}connectedCallback(){this._id=this.dataset.id,this._options=Object.assign({},b,this.dataset),this._id&&(this.handleStore(),n.register(this.handleStore))}disconnectedCallback(){n.unregister(this.handleStore)}handleStore(){if(this._id){var t=n.getData()[this._id];t&&this._options.type&&(this.src=t[this._options.type]||this.src)}}}customElements.define("constructor-selected-img",f,{extends:"img"});var S={},D=".js-amount";class E extends HTMLElement{constructor(){super(),this._id=void 0,this._options=S,this._spinner=null,this._model=null,this.handleStore=this.handleStore.bind(this),this.handleDispatcher=this.handleDispatcher.bind(this)}init(){}connectedCallback(){if(this._id=this.dataset.id,this._options=Object.assign({},S,this.dataset),this._id){this._spinner=this.querySelector(D),this._model=this.querySelector("model-3d");var t,e,i,r,a=this.querySelector("input.js-change-color:checked"),o=this.querySelector("input.js-change-texture:checked");a&&(t=a.dataset.color,e=v(a)),o&&(i=o.dataset.texture,r=v(o)),s.Z.emit({type:"constructor:add",id:this._id,color:t,colorPic:e,texture:i,texturePic:r}),n.register(this.handleStore),s.Z.register(this.handleDispatcher)}}disconnectedCallback(){n.unregister(this.handleStore),s.Z.unregister(this.handleDispatcher)}handleStore(){if(this._id){var t=n.getData()[this._id];this._model=this.querySelector("model-3d"),t&&(this._model&&t.color&&(this._model.dataset.frameColor=t.color,this._model.setAttribute("data-frame-color",t.color),s.Z.emit({type:"model-3d:update-colors",id:this._id})),this._model&&t.texturePic&&s.Z.emit({type:"model-3d:update-texture",id:this._id,texture:t.texture}))}}handleDispatcher(t){"change"===t.type&&t.target===this._spinner&&s.Z.emit({type:"constructor:amount",id:this._id,value:this._spinner.value}),"outlet-replaced"===t.type&&(this._spinner=this.querySelector(D))}}customElements.define("constructor-component",E)}}]);